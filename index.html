<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasir</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
    background-color: #f8f9fa;
    color: #343a40;
}

header {
    background-color: #6f42c1;
    color: white;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

header h1 {
    margin: 0;
    font-size: 2.5em;
    font-weight: 600;
}

nav a {
    color: white;
    text-decoration: none;
    margin: 0 15px;
    font-weight: 500;
    font-size: 1.1em;
    transition: color 0.3s ease;
}

nav a:hover {
    color: #ff6b6b;
}

main {
    padding: 20px;
}

table {
    width: 90%;
    margin: auto;
    border-collapse: collapse;
    background-color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
}

th, td {
    border: 1px solid #e9ecef;
    padding: 12px;
    text-align: center;
}

th {
    background-color: #6f42c1;
    color: white;
    font-weight: 600;
}

tr:nth-child(even) {
    background-color: #f1f3f5;
}

tr:hover {
    background-color: #e2e6ea;
}

form input, .pembayaran input, .kembalian, .total-bayar, .total-keseluruhan, .penghitung-item-box {
    padding: 10px;
    margin: 5px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 1em;
    transition: border-color 0.3s ease;
}

form input:focus, .pembayaran input:focus {
    border-color: #6f42c1;
    outline: none;
}

.kasir-popup, .overlay {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 30px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    border-radius: 8px;
}

.overlay {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999;
}

.daftar-item-kasir {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

.daftar-item-kasir .kolom {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.item-button, .filter-button, .batalkan-perubahan, .metode-pembayaran button {
    margin: 5px;
    padding: 10px;
    background-color: #e9ecef;
    border: 1px solid #ced4da;
    cursor: pointer;
    font-size: 1em;
    border-radius: 4px;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.item-button:hover, .filter-button:hover, .batalkan-perubahan:hover, .metode-pembayaran button:hover {
    background-color: #d3d3d3;
    transform: translateY(-2px);
}

.metode-pembayaran button.active {
    background-color: #6f42c1;
    color: white;
}

.tutup-merah {
    background-color: #e74c3c;
    color: white;
}

.lunas {
    background-color: #28a745;
    color: white;
    padding: 5px;
    border-radius: 4px;
}

.penghitung-item-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}

.penghitung-item-box {
    background-color: #f1f3f5;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    font-size: 1.2em;
    color: #6f42c1;
}

.tombol-keranjang {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #6f42c1;
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s ease, transform 0.2s ease;
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
    background-color: #f8f9fa;
    color: #343a40;
}

header {
    background-color: #6f42c1;
    color: white;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-radius: 0 0 10px 10px;
}

header h1 {
    margin: 0;
    font-size: 2.5em;
    font-weight: 600;
}

nav a {
    color: white;
    text-decoration: none;
    margin: 0 15px;
    font-weight: 500;
    font-size: 1.1em;
    transition: color 0.3s ease;
}

nav a:hover {
    color: #ff6b6b;
}

main {
    padding: 20px;
}

table {
    width: 90%;
    margin: 20px auto;
    border-collapse: collapse;
    background-color: white;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    overflow: hidden;
}

th, td {
    border: 1px solid #e9ecef;
    padding: 12px;
    text-align: center;
}

th {
    background-color: #6f42c1;
    color: white;
    font-weight: 600;
}

tr:nth-child(even) {
    background-color: #f1f3f5;
}

tr:hover {
    background-color: #e2e6ea;
}

form input, .pembayaran input, .kembalian, .total-bayar, .total-keseluruhan, .penghitung-item-box {
    padding: 12px;
    margin: 10px 5px;
    border: 1px solid #ced4da;
    border-radius: 6px;
    font-size: 1em;
    transition: border-color 0.3s ease;
    width: calc(100% - 30px);
    box-sizing: border-box;
}

form input:focus, .pembayaran input:focus {
    border-color: #6f42c1;
    outline: none;
    box-shadow: 0 0 5px rgba(111, 66, 193, 0.5);
}

button {
    padding: 10px 20px;
    margin: 10px 5px;
    border: none;
    border-radius: 6px;
    font-size: 1em;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    color: white;
}

button.filter-button, button.batalkan-perubahan, .metode-pembayaran button {
    background-color: #6f42c1;
}

button.filter-button:hover, button.batalkan-perubahan:hover, .metode-pembayaran button:hover {
    background-color: #5a33b0;
    transform: translateY(-2px);
}

button.item-button {
    background-color: #e9ecef;
    color: #6f42c1;
    width: 100%;
    padding: 15px;
    border: 1px solid #ced4da;
}

button.item-button:hover {
    background-color: #d3d3d3;
    color: #5a33b0;
}

.metode-pembayaran button.active {
    background-color: #491e83;
}

.tutup-merah {
    background-color: #e74c3c;
}

.lunas {
    background-color: #28a745;
    padding: 5px 10px;
    border-radius: 6px;
}

.penghitung-item-container {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.penghitung-item-box {
    background-color: #f1f3f5;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    font-size: 1.2em;
    color: #6f42c1;
    width: 150px;
}

.kasir-popup, .overlay {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 30px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    border-radius: 10px;
}

.overlay {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999;
}

.daftar-item-kasir {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.daftar-item-kasir .kolom {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.tombol-keranjang {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #6f42c1;
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.tombol-keranjang:hover {
    background-color: #5a33b0;
    transform: scale(1.1);
}

.tombol-aksi {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}

.tombol-aksi button {
    width: 100%;
    padding: 10px;
    font-size: 0.9em;
    margin: 5px 0;
}
    </style>
</head>
<body>
    <header>
        <h1>Kasir</h1>
        <nav>
            <a href="#" onclick="tampilkanHalaman('kasir')">Kasir</a> |
            <a href="#" onclick="tampilkanHalaman('database')">Kelola Item & Harga</a>
        </nav>
    </header>
    <main>
        <section id="kasir">
            <h2>Riwayat Penjualan</h2>
            <button class="filter-button" onclick="tampilkanSemua()">Semua</button>
            <button class="filter-button" onclick="filterCash()">Cash</button>
            <button class="filter-button" onclick="filterCashless()">Cashless</button>
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Item</th>
                        <th>Total</th>
                        <th>Ket</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="riwayat-penjualan"></tbody>
            </table>
            <div class="total-keseluruhan" id="total-keseluruhan">Total Keseluruhan: Rp 0</div>
            <div class="penghitung-item-container" id="penghitung-item">
                <div class="penghitung-item-box">Bakso: <span id="bakso-count">0</span> Porsi</div>
                <div class="penghitung-item-box">Pangsit: <span id="pangsit-count">0</span> Porsi</div>
                <div class="penghitung-item-box">Ketupat: <span id="ketupat-count">0</span> Biji</div>
                <div class="penghitung-item-box">Bakwan: <span id="bakwan-count">0</span> Biji</div>
                <div class="penghitung-item-box">Kacang: <span id="kacang-count">0</span> Bungkus</div>
            </div>
            <div class="overlay" id="overlay"></div>
            <div class="kasir-popup" id="kasir-popup">
                <h2>Kasir</h2>
                <div class="daftar-item-kasir" id="daftar-item-kasir">
                    <div class="kolom" id="kolom-bakso"><h3>Bakso</h3></div>
                    <div class="kolom" id="kolom-pangsit-biji"><h3>Pangsit & Biji</h3></div>
                    <div class="kolom" id="kolom-lainnya"><h3>Lainnya</h3></div>
                </div>
                <h3>Daftar Belanja</h3>
                <div class="daftar-belanja">
                    <table>
                        <thead>
                            <tr>
                                <th>Nama Item</th>
                                <th>Jumlah</th>
                                <th>Harga Satuan</th>
                                <th>Total</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="daftar-belanja"></tbody>
                    </table>
                </div>
                <div class="total-bayar" id="total-bayar">Total Bayar: Rp 0</div>
                <div class="pembayaran">
                    <input type="text" id="uang-pembayaran" placeholder="Uang Pembayaran (Rp)" oninput="formatInput(this)">
                    <div id="grab-total-harga" style="display: none;">
                        <input type="text" id="total-harga-grab" placeholder="Total Harga GRAB (Rp)" oninput="formatInput(this)">
                    </div>
                    <button onclick="hitungKembalian()" class="filter-button">Hitung Kembalian</button>
                </div>
                <div class="kembalian" id="kembalian">Kembalian: Rp 0</div>
                <div class="metode-pembayaran">
                    <button onclick="pilihMetodePembayaran('CASH')">CASH</button>
                    <button onclick="pilihMetodePembayaran('QRIS')">QRIS</button>
                    <button onclick="pilihMetodePembayaran('TF')">TF</button>
                    <button onclick="pilihMetodePembayaran('GRAB')">GRAB</button>
                </div>
                <button onclick="simpanTransaksi()" class="filter-button">Simpan Transaksi</button>
                <button onclick="tutupKasir()" class="batalkan-perubahan">Tutup</button>
                <button class="batalkan-perubahan" id="batalkan-perubahan" onclick="batalkanPerubahan()" style="display: none;">Batalkan Perubahan</button>
            </div>
        </section>
        <section id="database" style="display: none;">
            <h2>Tambah Item</h2>
            <form id="form-item">
                <input type="text" id="nama-item" placeholder="Nama Item" required>
                <input type="text" id="harga-item" placeholder="Harga (Rp)" oninput="formatInput(this)" required>
                <button type="submit" class="filter-button">Tambahkan</button>
            </form>
            <h2>Daftar Item</h2>
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Item</th>
                        <th>Harga</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="daftar-item"></tbody>
            </table>
        </section>
    </main>
    <button class="tombol-keranjang" onclick="bukaKasir()">🛒</button>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            tampilkanSemua();
            loadItems();
            setupForm();
        });

        function formatRupiah(angka) {
            return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function hapusPemisahRibuan(angka) {
            return angka.replace(/\./g, "");
        }

        function formatInput(input) {
            let nilai = input.value;
            let nilaiTanpaPemisah = hapusPemisahRibuan(nilai);
            if (!isNaN(nilaiTanpaPemisah)) {
                input.value = formatRupiah(nilaiTanpaPemisah);
            } else {
                input.value = "";
            }
        }

        let metodePembayaranTerpilih = "";
        let indexTransaksiEdit = null;

        function pilihMetodePembayaran(metode) {
            metodePembayaranTerpilih = metode;
            toggleActiveButton(metode);
            toggleGrabInput(metode);
        }

        function toggleActiveButton(metode) {
            document.querySelectorAll('.metode-pembayaran button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`.metode-pembayaran button[onclick="pilihMetodePembayaran('${metode}')"]`).classList.add('active');
        }

        function toggleGrabInput(metode) {
            document.getElementById("grab-total-harga").style.display = metode === "GRAB" ? "block" : "none";
        }

        function tampilkanRiwayat(filter = null) {
            let riwayat = JSON.parse(localStorage.getItem("riwayatPenjualan")) || [];
            let riwayatPenjualan = document.getElementById("riwayat-penjualan");
            let totalKeseluruhan = 0;

            riwayatPenjualan.innerHTML = "";

            if (filter) {
                riwayat = riwayat.filter(item => filter === "CASH" ? item.keterangan === "CASH" : item.keterangan !== "CASH");
            }

            riwayat.forEach((item, index) => {
                totalKeseluruhan += item.total;
                let namaItem = item.nama.split(", ").join("<br>");
                let row = createRow(index, namaItem, item.total, item.keterangan);
                riwayatPenjualan.innerHTML += row;
            });

            document.getElementById("total-keseluruhan").innerText = `Total Keseluruhan: Rp ${formatRupiah(totalKeseluruhan)}`;
            hitungItemTerjual(riwayat);
        }

        function createRow(index, namaItem, total, keterangan) {
            return `<tr>
                <td>${index + 1}</td>
                <td>${namaItem}</td>
                <td>Rp ${formatRupiah(total)}</td>
                <td>${keterangan}</td>
                <td>
                    <div class="tombol-aksi">
                        <button onclick="tandaiLunas(${index})" class="filter-button">Lunas</button>
                        <button onclick="editTransaksi(${index})" class="filter-button">Edit</button>
                        <button onclick="hapusTransaksi(${index})" class="batalkan-perubahan">Hapus</button>
                    </div>
                </td>
            </tr>`;
        }

        function hitungItemTerjual(riwayat) {
            let penghitung = { Bakso: 0, Pangsit: 0, Ketupat: 0, Bakwan: 0, Kacang: 0 };

            riwayat.forEach((transaksi) => {
                transaksi.nama.split(", ").forEach((item) => {
                    let [jumlah, ...nama] = item.split(" ");
                    let namaItem = nama.join(" ");
                    if (namaItem.toLowerCase().includes("bakso")) penghitung.Bakso += parseInt(jumlah);
                    if (namaItem.toLowerCase().includes("pangsit")) penghitung.Pangsit += parseInt(jumlah);
                    if (namaItem.toLowerCase().includes("ketupat")) penghitung.Ketupat += parseInt(jumlah);
                    if (namaItem.toLowerCase().includes("bakwan")) penghitung.Bakwan += parseInt(jumlah);
                    if (namaItem.toLowerCase().includes("kacang")) penghitung.Kacang += parseInt(jumlah);
                });
            });

            updatePenghitungItem(penghitung);
        }

        function updatePenghitungItem(penghitung) {
            document.getElementById("bakso-count").innerText = penghitung.Bakso;
            document.getElementById("pangsit-count").innerText = penghitung.Pangsit;
            document.getElementById("ketupat-count").innerText = penghitung.Ketupat;
            document.getElementById("bakwan-count").innerText = penghitung.Bakwan;
            document.getElementById("kacang-count").innerText = penghitung.Kacang;
        }

        function tampilkanSemua() {
            tampilkanRiwayat();
        }

        function filterCash() {
            tampilkanRiwayat("CASH");
        }

        function filterCashless() {
            tampilkanRiwayat("CASHLESS");
        }

        function loadItems() {
            let daftar = JSON.parse(localStorage.getItem("daftarItem")) || [];
            let daftarItem = document.getElementById("daftar-item");

            daftar.forEach((item, index) => {
                let row = `<tr>
                    <td>${index + 1}</td>
                    <td>${item.nama}</td>
                    <td>Rp ${formatRupiah(item.harga)}</td>
                    <td>
                        <div class="tombol-aksi">
                            <button onclick="hapusItem(${index})" class="batalkan-perubahan">Hapus</button>
                        </div>
                    </td>
                </tr>`;
                daftarItem.innerHTML += row;
            });
        }

        function setupForm() {
            let formItem = document.getElementById("form-item");
            formItem.addEventListener("submit", function (e) {
                e.preventDefault();
                let nama = document.getElementById("nama-item").value;
                let harga = hapusPemisahRibuan(document.getElementById("harga-item").value);

                let daftar = JSON.parse(localStorage.getItem("daftarItem")) || [];
                daftar.push({ nama, harga });
                localStorage.setItem("daftarItem", JSON.stringify(daftar));

                let row = `<tr>
                    <td>${daftar.length}</td>
                    <td>${nama}</td>
                    <td>Rp ${formatRupiah(harga)}</td>
                    <td>
                        <div class="tombol-aksi">
                            <button onclick="hapusItem(${daftar.length - 1})" class="batalkan-perubahan">Hapus</button>
                        </div>
                    </td>
                </tr>`;
                document.getElementById("daftar-item").innerHTML += row;
                formItem.reset();
            });
        }

        function tampilkanHalaman(halaman) {
            document.getElementById("kasir").style.display = halaman === 'kasir' ? "block" : "none";
            document.getElementById("database").style.display = halaman === 'database' ? "block" : "none";
        }

        function bukaKasir() {
            document.getElementById("overlay").style.display = "block";
            document.getElementById("kasir-popup").style.display = "block";

            let daftar = JSON.parse(localStorage.getItem("daftarItem")) || [];
            let daftarItemKasir = document.getElementById("daftar-item-kasir");

            resetKolom();
            tampilkanItemKasir(daftar);
            perbaruiDaftarBelanja();
        }

        function resetKolom() {
            document.getElementById("kolom-bakso").innerHTML = "<h3>Bakso</h3>";
            document.getElementById("kolom-pangsit-biji").innerHTML = "<h3>Pangsit & Biji</h3>";
            document.getElementById("kolom-lainnya").innerHTML = "<h3>Lainnya</h3>";
        }

        function tampilkanItemKasir(daftar) {
            daftar.forEach((item) => {
                let button = `<button class="item-button" onclick="tambahKeBelanja('${item.nama}', ${item.harga})">${item.nama} - Rp ${formatRupiah(item.harga)}</button>`;
                if (item.nama.toLowerCase().includes("bakso")) {
                    document.getElementById("kolom-bakso").innerHTML += button;
                } else if (item.nama.toLowerCase().includes("pangsit") || item.nama.toLowerCase().includes("biji")) {
                    document.getElementById("kolom-pangsit-biji").innerHTML += button;
                } else {
                    document.getElementById("kolom-lainnya").innerHTML += button;
                }
            });
        }

        function tutupKasir() {
            let belanja = JSON.parse(localStorage.getItem("belanja")) || [];
            if (belanja.length > 0) {
                alert("Tolong Selesaikan Transaksi!");
                return;
            }
            document.getElementById("overlay").style.display = "none";
            document.getElementById("kasir-popup").style.display = "none";
        }

        function tambahKeBelanja(nama, harga) {
            let belanja = JSON.parse(localStorage.getItem("belanja")) || [];
            let item = belanja.find((item) => item.nama === nama);

            if (item) {
                item.jumlah += 1;
            } else {
                belanja.push({ nama, harga, jumlah: 1 });
            }

            localStorage.setItem("belanja", JSON.stringify(belanja));
            perbaruiDaftarBelanja();
        }

        function perbaruiDaftarBelanja() {
            let belanja = JSON.parse(localStorage.getItem("belanja")) || [];
            let daftarBelanja = document.getElementById("daftar-belanja");
            let totalBayar = 0;

            let belanjaGabung = gabungItem(belanja);
            daftarBelanja.innerHTML = "";

            belanjaGabung.forEach((item) => {
                let totalHarga = item.harga * item.jumlah;
                totalBayar += totalHarga;
                let row = createBelanjaRow(item, totalHarga);
                daftarBelanja.innerHTML += row;
            });

            document.getElementById("total-bayar").innerText = `Total Bayar: Rp ${formatRupiah(totalBayar)}`;
            updateTutupButton(belanja.length);
        }

        function gabungItem(belanja) {
            let belanjaGabung = [];
            belanja.forEach((item) => {
                let itemExist = belanjaGabung.find((i) => i.nama === item.nama);
                if (itemExist) {
                    itemExist.jumlah += item.jumlah;
                } else {
                    belanjaGabung.push({ ...item });
                }
            });
            return belanjaGabung;
        }

        function createBelanjaRow(item, totalHarga) {
            return `<tr>
                <td>${item.nama}</td>
                <td>${item.jumlah}</td>
                <td>Rp ${formatRupiah(item.harga)}</td>
                <td>Rp ${formatRupiah(totalHarga)}</td>
                <td>
                    <div class="tombol-aksi">
                        <button onclick="hapusDariBelanja('${item.nama}')" class="batalkan-perubahan">Hapus</button>
                    </div>
                </td>
            </tr>`;
        }

        function updateTutupButton(length) {
            let tombolTutup = document.querySelector("#kasir-popup button[onclick='tutupKasir()']");
            if (length > 0) {
                tombolTutup.classList.add("tutup-merah");
            } else {
                tombolTutup.classList.remove("tutup-merah");
            }
        }

        function hapusDariBelanja(nama) {
            let belanja = JSON.parse(localStorage.getItem("belanja")) || [];
            belanja = belanja.filter((item) => item.nama !== nama);
            localStorage.setItem("belanja", JSON.stringify(belanja));
            perbaruiDaftarBelanja();
        }

        function hitungKembalian() {
            let totalBayar = parseFloat(hapusPemisahRibuan(document.getElementById("total-bayar").innerText.replace("Total Bayar: Rp ", "")));
            let uangPembayaran = parseFloat(hapusPemisahRibuan(document.getElementById("uang-pembayaran").value));

            if (isNaN(uangPembayaran)) {
                alert("Masukkan jumlah uang pembayaran!");
                return;
            }

            if (uangPembayaran < totalBayar) {
                alert("Uang pembayaran tidak cukup!");
                return;
            }

            let kembalian = uangPembayaran - totalBayar;
            document.getElementById("kembalian").innerText = `Kembalian: Rp ${formatRupiah(kembalian)}`;
        }

        function simpanTransaksi() {
            let belanja = JSON.parse(localStorage.getItem("belanja")) || [];
            if (belanja.length === 0) {
                alert("Belanjaan kosong!");
                return;
            }

            let riwayat = JSON.parse(localStorage.getItem("riwayatPenjualan")) || [];
            let totalBayar = belanja.reduce((total, item) => total + item.harga * item.jumlah, 0);

            if (metodePembayaranTerpilih === "GRAB") {
                let totalHargaGrab = hapusPemisahRibuan(document.getElementById("total-harga-grab").value);
                if (!totalHargaGrab || isNaN(totalHargaGrab)) {
                    alert("Masukkan total harga GRAB yang valid!");
                    return;
                }
                totalBayar = parseFloat(totalHargaGrab);
            }

            let namaItem = belanja.map(item => `${item.jumlah} ${item.nama}`).join(", ");
            let transaksi = {
                nama: namaItem,
                jumlah: belanja.reduce((total, item) => total + item.jumlah, 0),
                total: totalBayar,
                keterangan: metodePembayaranTerpilih || "CASH",
                lunas: false,
            };

            if (indexTransaksiEdit !== null) {
                riwayat[indexTransaksiEdit] = transaksi;
                indexTransaksiEdit = null;
            } else {
                riwayat.push(transaksi);
            }

            localStorage.setItem("riwayatPenjualan", JSON.stringify(riwayat));
            localStorage.removeItem("belanja");
            metodePembayaranTerpilih = "";
            tutupKasir();
            location.reload();
        }

        function hapusItem(index) {
            let pin = prompt("Masukkan PIN untuk menghapus item:");
            if (pin !== "0000") {
                alert("PIN salah! Penghapusan dibatalkan.");
                return;
            }

            let daftar = JSON.parse(localStorage.getItem("daftarItem")) || [];
            daftar.splice(index, 1);
            localStorage.setItem("daftarItem", JSON.stringify(daftar));
            location.reload();
        }

        function tandaiLunas(index) {
            let riwayat = JSON.parse(localStorage.getItem("riwayatPenjualan")) || [];
            riwayat[index].lunas = true;
            localStorage.setItem("riwayatPenjualan", JSON.stringify(riwayat));
            location.reload();
        }

        function editTransaksi(index) {
            let riwayat = JSON.parse(localStorage.getItem("riwayatPenjualan")) || [];
            let transaksi = riwayat[index];
            indexTransaksiEdit = index;

            let belanja = JSON.parse(localStorage.getItem("belanja")) || [];
            transaksi.nama.split(", ").forEach((item) => {
                let [jumlah, ...nama] = item.split(" ");
                let namaItem = nama.join(" ");
                let harga = JSON.parse(localStorage.getItem("daftarItem")).find((item) => item.nama === namaItem).harga;
                belanja.push({ nama: namaItem, harga, jumlah: parseInt(jumlah) });
            });

            localStorage.setItem("belanja", JSON.stringify(belanja));
            pilihMetodePembayaran(transaksi.keterangan);

            if (transaksi.keterangan === "GRAB") {
                document.getElementById("total-harga-grab").value = formatRupiah(transaksi.total);
            }

            document.getElementById("batalkan-perubahan").style.display = "inline-block";
            bukaKasir();
        }

        function batalkanPerubahan() {
            indexTransaksiEdit = null;
            localStorage.removeItem("belanja");
            document.getElementById("batalkan-perubahan").style.display = "none";
            tutupKasir();
        }

        function hapusTransaksi(index) {
            let pin = prompt("Masukkan PIN untuk menghapus transaksi:");
            if (pin !== "0000") {
                alert("PIN salah! Penghapusan dibatalkan.");
                return;
            }

            let riwayat = JSON.parse(localStorage.getItem("riwayatPenjualan")) || [];
            riwayat.splice(index, 1);
            localStorage.setItem("riwayatPenjualan", JSON.stringify(riwayat));
            location.reload();
        }
    </script>
</body>
</html>
